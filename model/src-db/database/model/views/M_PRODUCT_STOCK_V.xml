<?xml version="1.0"?>
  <database name="VIEW M_PRODUCT_STOCK_V">
    <view name="M_PRODUCT_STOCK_V"><![CDATA[SELECT p.m_product_id || COALESCE(sd.m_storage_detail_id, '') AS m_product_stock_v_id, p.ad_client_id, COALESCE(sd.ad_org_id, p.ad_org_id) AS ad_org_id, COALESCE(sd.isactive, p.isactive) AS isactive, p.created, p.createdby, p.updated, p.updatedby, p.m_product_id, COALESCE(sd.qtyonhand, 0) AS qtyonhand, sd.qtyorderonhand, COALESCE(sd.preqtyonhand, 0) AS preqtyonhand, sd.preqtyorderonhand, p.c_uom_id, sd.m_product_uom_id, COALESCE(sd.m_attributesetinstance_id, 
CASE p.attrsetvaluetype
WHEN 'D' THEN p.m_attributesetinstance_id
ELSE NULL
END) AS m_attributesetinstance_id, sd.m_locator_id, 
CASE
WHEN sd.m_storage_detail_id IS NOT NULL THEN 'Y'
ELSE 'N'
END AS stocked
FROM m_product p
LEFT JOIN (SELECT p.m_product_id || sdd.m_storage_detail_id AS m_product_stock_v_id, sdd.m_storage_detail_id, l.ad_client_id, l.ad_org_id, l.isactive, sdd.created, sdd.createdby, sdd.updated, sdd.updatedby, sdd.m_product_id, sdd.qtyonhand, sdd.qtyorderonhand, sdd.preqtyonhand, sdd.preqtyorderonhand, sdd.c_uom_id, sdd.m_product_uom_id, sdd.m_attributesetinstance_id, sdd.m_locator_id, 'Y' AS stocked
FROM m_storage_detail sdd
JOIN m_locator l ON sdd.m_locator_id = l.m_locator_id
JOIN m_product p ON sdd.m_product_id = p.m_product_id AND p.isactive = 'Y'
WHERE sdd.qtyonhand <> 0 OR COALESCE(sdd.qtyorderonhand, 0) <> 0) sd ON p.m_product_id = sd.m_product_id]]></view>
  </database>
